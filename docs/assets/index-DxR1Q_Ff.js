(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const v={hour:"2-digit",minute:"2-digit",second:"2-digit"},L={day:"2-digit",month:"long",weekday:"long"},h=document.querySelector(".time"),f=document.querySelector(".date");let i=new Date,y=i.getHours();function p(){i=new Date,h&&f&&(h.textContent=i.toLocaleTimeString("ru-RU",v),f.textContent=i.toLocaleDateString("ru-RU",L)),k()&&window.dispatchEvent(new Event("newHour"))}function k(){return i.getHours()!==y?(y=i.getHours(),!0):!1}const u={night:[22,23,0,1,2,3],morning:[4,5,6,7,8,9],day:[10,11,12,13,14,15],evening:[16,17,18,19,20,21]};function w(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}const s={currentBackground:"background__item--showing[data-time]",activeBackground:"background__item--showing",allBackgrounds:"[data-time]",timeOfDayBackground(e){return`[data-time="${e}"]`}},m={change(e){const t=this.define(e);this.remove(),this.set(t)},set(e){const t=document.querySelector(s.timeOfDayBackground(e));t&&t.classList.add(s.activeBackground)},setRandom(){const t=document.querySelector(`.${s.currentBackground}`)?.dataset.time??"day";let o=w(0,23),a=t!==this.define(o);for(;!a;)o=w(0,23),a=t!==this.define(o);a&&this.change(o)},remove(){document.querySelectorAll(s.allBackgrounds).forEach(t=>t.classList.remove(s.activeBackground))},define(e){let t="day";return u.night.includes(e)?t="night":u.morning.includes(e)?t="morning":u.day.includes(e)?t="day":u.evening.includes(e)&&(t="evening"),t}};window.addEventListener("newHour",()=>{const e=i.getHours();m.change(e)});const d={clearWeather:[0,1,2,3],cloudyWeather:[45,48,51,53,55,56,57],rainyWeather:[61,63,65,66,67,80,81,82,95,96,99],snowyWeather:[71,73,75,77,85,86]};function E(e){return d.clearWeather.includes(e)?"sun-icon":d.cloudyWeather.includes(e)?"cloud-icon":d.rainyWeather.includes(e)?"rain-icon":d.snowyWeather.includes(e)?"snow-icon":""}async function g(){const e=document.querySelector(".utility__value"),t=document.querySelector(".city"),o=document.querySelector(".weather .utility__value"),a=["sun-icon","cloud-icon","rain-icon","snow-icon"],{city:n,temperature:r,wmoCode:c}=await S();e&&(e.textContent=`${r}°`),t&&(t.textContent=`${n}`),o&&(o.classList.remove(...a),o.classList.add(E(c)))}window.addEventListener("newHour",()=>{g()});const D="Москва",l={name:D,async changeCity(){const e=this.name,t=prompt("Укажите город","");if(t)try{this.name=t,await g()}catch{alert("Неправильно указан город"),this.name=e,this.changeCity()}},async getCoordinates(){const e=`https://geocoding-api.open-meteo.com/v1/search?name=${this.name}&count=1&language=ru&format=json`,a=(await(await fetch(e)).json()).results?.[0],{latitude:n,longitude:r,name:c}=a;return{city:c,latitude:n,longitude:r}},async getWeaterApiLink(){const{latitude:e,longitude:t}=await l.getCoordinates();return`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&current=temperature_2m,precipitation,rain,showers,snowfall,weather_code,cloud_cover&timezone=Europe%2FMoscow&forecast_days=1`}};async function B(){const e=await l.getWeaterApiLink();return await(await fetch(e)).json()}async function S(){const e=await l.getCoordinates(),t=await B();let o=Math.round(t.current.temperature_2m);return{city:e.city,temperature:o,wmoCode:t.current.weather_code}}function C(){const e=document.querySelector(".random-background"),t=document.querySelector(".change-city");e?.addEventListener("click",()=>m.setRandom()),t?.addEventListener("click",()=>l.changeCity())}(function(){const t=i.getHours(),o=1e3;C(),p(),setInterval(p,o),g(),m.change(t)})();
